#!/bin/bash

set -euo pipefail
IFS=$'\n\t'

export LAUNCHPAD_API="https://api.staging.launchpad.net/"

# check & update
cat > fossa-varys.json <<ENDLINE
{
  "certification-hardware": [
    "202001-27664",
    "202001-27665",
    "202001-27666",
    "202001-27667",
    "202005-27873",
    "202005-27874"
  ],
  "certify-planning": [
    1904011
  ],
  "mirbug": 1937243,
  "productnames": [
    "Precision 5550"
  ]
}
ENDLINE

export COPYRIGHT_YEAR=2021

mir-bug update --yes --skip --ready --release fossa-varys.json

mir-bug check --skip --ready --release fossa-varys.json

mir-bug update --yes --skip --tz=UTC --release fossa-varys.json

mir-bug check --skip --tz=UTC --release fossa-varys.json

# create
mir-bug create -o bug_id somerville bronn "some Dell platforms"
BUG_ID=$(cat bug_id)
lp-bug cleanup --yes "$BUG_ID"
rm bug_id

# collect
mir-bug collect "$AUTOPKGTEST_ARTIFACTS"/oem-meta-mir-bugs.json
mir-bug collect --ubuntu-certified "$AUTOPKGTEST_ARTIFACTS"/oem-meta-mir-bugs-ubuntu-certified.json

exit 77
